# Steam 사용자 리뷰 크롤러

`steam_reviews.csv` 파일에서 `author_steamid`를 추출하여 해당 사용자들이 작성한 모든 리뷰를 수집하는 프로그램입니다.

## 기능

- CSV 파일에서 고유한 Steam ID 추출
- Steam API를 통한 사용자별 전체 리뷰 수집
- **사용자 게임 라이브러리 및 플레이 시간 정보 수집** ⭐
- 수집된 데이터를 CSV 형태로 저장
- **중간부터 재시작 기능** (프로그램 중단 시 이어서 진행)
- **Steam 차단 방지 안전 모드**
- 중간 저장 기능으로 데이터 손실 방지
- 요청 제한을 고려한 지연 시간 설정
- 실시간 진행상황 모니터링

## 설치

```bash
pip install -r requirements.txt
```

## 사용법

### 기본 실행

```bash
python user_reviews_crawler.py
```

### 설정 옵션

`user_reviews_crawler.py` 파일의 `main()` 함수에서 다음 설정을 변경할 수 있습니다:

```python
input_csv = "data/steam_reviews.csv"         # 입력 CSV 파일 경로
output_csv = "data/user_all_reviews.csv"     # 리뷰 출력 CSV 파일 경로
games_library_csv = "data/user_games_library.csv"  # 게임 라이브러리 출력 CSV 파일 경로

# 기능 설정
COLLECT_REVIEWS = True           # 리뷰 수집 여부
COLLECT_GAMES_LIBRARY = True     # 게임 라이브러리 정보 수집 여부

# 안전 모드 설정
SAFE_MODE = True                 # 안전 모드 (더 긴 지연시간)
MAX_USERS_PER_SESSION = 100      # 한 세션당 최대 처리 사용자 수
```

## 작동 방식

### Steam 공개 API 활용 🚀
**API 키 불필요 - 완전 무료!**

1. **리뷰 수집**:
   - 사용자가 소유한 게임 목록을 Steam 공개 API로 조회
   - 각 게임의 리뷰에서 해당 사용자가 작성한 리뷰 검색
   - 발견된 리뷰의 상세 정보 수집

2. **게임 라이브러리 수집**:
   - Steam 공개 API에서 사용자의 게임 소유 목록 조회
   - 각 게임별 플레이 시간 정보 수집
   - 플랫폼별 플레이 시간 (Windows/Mac/Linux) 수집

## 출력 데이터 구조

### 리뷰 데이터 (`user_all_reviews.csv`)

수집된 리뷰 데이터는 다음 컬럼을 포함합니다:

| 컬럼명 | 설명 |
|--------|------|
| `steamid` | 사용자 Steam ID |
| `appid` | 게임 App ID |
| `game_name` | 게임 이름 |
| `recommendationid` | 리뷰 고유 ID |
| `review_text` | 리뷰 내용 |
| `voted_up` | 추천 여부 |
| `votes_up` | 도움됨 투표 수 |
| `votes_funny` | 재미있음 투표 수 |
| `weighted_vote_score` | 가중 투표 점수 |
| `comment_count` | 댓글 수 |
| `steam_purchase` | Steam 구매 여부 |
| `received_for_free` | 무료 제공 여부 |
| `written_during_early_access` | 얼리액세스 중 작성 여부 |
| `timestamp_created` | 작성 시간 |
| `timestamp_updated` | 수정 시간 |
| `playtime_forever` | 총 플레이 시간 |
| `playtime_last_two_weeks` | 최근 2주 플레이 시간 |
| `playtime_at_review` | 리뷰 작성 시점 플레이 시간 |
| `last_played` | 마지막 플레이 시간 |

### 게임 라이브러리 데이터 (`user_games_library.csv`) ⭐

사용자별 게임 소유 및 플레이 시간 정보:

| 컬럼명 | 설명 |
|--------|------|
| `steamid` | 사용자 Steam ID |
| `appid` | 게임 App ID |
| `game_name` | 게임 이름 |
| `playtime_forever` | 총 플레이 시간 (분) |
| `playtime_windows_forever` | Windows에서 플레이 시간 |
| `playtime_mac_forever` | Mac에서 플레이 시간 |
| `playtime_linux_forever` | Linux에서 플레이 시간 |
| `playtime_2weeks` | 최근 2주 플레이 시간 |
| `rtime_last_played` | 마지막 플레이 타임스탬프 |
| `has_community_visible_stats` | 커뮤니티 통계 공개 여부 |
| `playtime_disconnected` | 오프라인 플레이 시간 |

## 안전 기능 🛡️

### 중간부터 재시작
- 프로그램이 중단되어도 다시 실행하면 이미 완료된 사용자를 건너뛰고 이어서 진행
- 리뷰와 게임 라이브러리 데이터를 각각 독립적으로 추적

### Steam 차단 방지
- **안전 모드**: 더 긴 지연시간으로 차단 위험 최소화
- **연속 실패 감지**: 3회 연속 실패 시 경고, 5회 시 5분 대기
- **세션 제한**: 한 번에 최대 100명까지만 처리 (설정 가능)
- **응답 시간 모니터링**: 서버 응답 지연 시 자동 조정

### 에러 복구
- 개별 사용자 처리 실패 시에도 전체 작업 계속 진행
- 중간 저장으로 데이터 손실 방지

## 주의사항

1. **API 키 불필요**: Steam 공개 API를 사용하므로 별도의 API 키가 필요하지 않습니다! 🎉

2. **요청 제한**: Steam의 Rate Limiting으로 인해 대량의 데이터 수집 시 시간이 오래 걸릴 수 있습니다.

3. **차단 위험**: 너무 빠른 요청이나 대량 요청 시 IP 차단 가능성이 있습니다.
   - 안전 모드 사용 권장 (기본값)
   - 여러 세션으로 나누어 진행

4. **프라이버시**: 공개 프로필의 정보만 수집 가능하며, 비공개 프로필의 경우 수집이 제한됩니다.

5. **Steam 정책**: Steam의 이용약관 및 로봇 정책을 준수하여 사용하시기 바랍니다.

## 트러블슈팅

### 일반적인 문제

1. **CSV 파일을 찾을 수 없음**
   - `data/steam_reviews.csv` 파일이 존재하는지 확인
   - 파일 경로가 올바른지 확인

2. **API 응답 오류**
   - 네트워크 연결 상태 확인
   - Steam 서버 상태 확인
   - 요청 간격을 늘려서 재시도

3. **빈 결과**
   - 사용자 프로필이 공개되어 있는지 확인
   - Steam API 키가 올바른지 확인 (사용하는 경우)

## 진행상황 모니터링 기능

프로그램에는 다음과 같은 진행상황 확인 기능이 포함되어 있습니다:

### 실시간 프로그레스 바
- 전체 사용자 대비 현재 처리 진행률
- 경과 시간 및 남은 시간 예측
- 완료 예정 시간 표시

### 상세 통계 정보
- **5명마다**: 간단한 중간 통계 (수집된 리뷰 수, 성공률)
- **10명마다**: 상세한 진행 통계 및 중간 저장
  - 처리된 사용자 수
  - 수집된 리뷰 총 개수
  - 성공률 (%)
  - 사용자당 평균 리뷰 수
  - 실패한 사용자 수
  - 경과 시간

### 최종 결과 요약
크롤링 완료 후 다음 정보를 제공합니다:
- 총 처리된 사용자 수
- 수집된 리뷰 총 개수
- 성공/실패 사용자 수 및 성공률
- 사용자당 평균 리뷰 수
- 총 소요 시간
- 시작/완료 시간

## 예시 실행 결과

```
🚀 Steam 사용자 리뷰 크롤링 시작
==================================================
✅ 1250개의 고유한 Steam ID를 찾았습니다.

🎯 총 1250명의 사용자 리뷰 수집을 시작합니다.
⏰ 시작 시간: 2024-01-15 14:30:25
======================================================================

사용자 처리 |██████████████████████████████| 10/1250 (0.8%) [경과: 0:02:15, 남은시간: 4:35:20, 완료예정: 19:05:45]

[10/1250] Steam ID: 76561198165794675
⏱️  현재 시간: 14:32:40
  🎮 45개 게임을 소유하고 있습니다.
    게임 검색 중... (15/50) Half-Life 2
    ✅ Cyberpunk 2077: 1개 리뷰 발견
    ✅ The Witcher 3: 1개 리뷰 발견
  ✅ 총 2개 리뷰 수집 성공!

✅ 20개 리뷰를 data/user_all_reviews.csv에 저장했습니다.

📊 현재 통계:
   • 처리된 사용자: 10/1250
   • 수집된 리뷰: 20개
   • 성공률: 80.0%
   • 사용자당 평균 리뷰: 2.5개
   • 실패한 사용자: 2명
   • 경과 시간: 0:02:15
==================================================

🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉
🎉 크롤링 완료! 최종 결과 🎉
🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉
📁 결과 파일: data/user_all_reviews.csv
📊 처리된 사용자: 1250명
🔍 수집된 리뷰: 3240개
✅ 성공한 사용자: 987명
❌ 실패한 사용자: 263명
📈 성공률: 78.9%
⚡ 사용자당 평균 리뷰: 3.3개
⏱️  총 소요 시간: 2:34:18
🕐 시작 시간: 2024-01-15 14:30:25
🕐 완료 시간: 2024-01-15 17:04:43
======================================================================
```